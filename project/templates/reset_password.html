{% extends "base.html" %}

{% block title %}Restablecer Contraseña{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8">
        <div>
            <img class="mx-auto h-24 w-auto" src="{{ url_for('static', filename='logo.png') }}" alt="IRDEBG">
            <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
                Restablecer Contraseña
            </h2>
            <p class="mt-2 text-center text-sm text-gray-600">
                Ingresa tu nueva contraseña.
            </p>
        </div>
        <form class="mt-8 space-y-6" action="{{ url_for('auth.reset_password') }}" method="POST" id="resetForm">
            <!-- Campo oculto para el access_token -->
            <input type="hidden" name="access_token" id="access_token">
            <input type="hidden" name="refresh_token" id="refresh_token">

            <div class="rounded-md shadow-sm -space-y-px">
                <div>
                    <label for="password" class="sr-only">Nueva Contraseña</label>
                    <input id="password" name="password" type="password" required
                        class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                        placeholder="Nueva Contraseña">
                </div>
                <div>
                    <label for="confirm_password" class="sr-only">Confirmar Contraseña</label>
                    <input id="confirm_password" name="confirm_password" type="password" required
                        class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                        placeholder="Confirmar Contraseña">
                </div>
            </div>

            <div>
                <button type="submit"
                    class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Cambiar Contraseña
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Script para extraer el token del fragmento de la URL (#)
    document.addEventListener('DOMContentLoaded', function () {
        const hash = window.location.hash.substring(1);
        const params = new URLSearchParams(hash);
        const accessToken = params.get('access_token');
        const refreshToken = params.get('refresh_token');
        const type = params.get('type');
        const errorDescription = params.get('error_description');

        if (accessToken) {
            document.getElementById('access_token').value = accessToken;
        }
        if (refreshToken) {
            document.getElementById('refresh_token').value = refreshToken;
        }

        if (errorDescription) {
            alert('Error: ' + decodeURIComponent(errorDescription));
        }

        // Si no hay token en el hash, verificar si ya estamos logueados o mostrar error
        if (!accessToken && type !== 'recovery' && !errorDescription) {
            // Opcional: Mostrar mensaje si no se encuentra el token
            console.log("No access token found in URL fragment");
        }
    });
</script>
{% endblock %}